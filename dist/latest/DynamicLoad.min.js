var DynamicLoad;(function(b){var a=(function(){function c(e,d){this.callback=[];this.method=e;this.url=d}c.prototype.addCallback=function(d){this.callback.push(d);return this};c.prototype.send=function(e){var g=this.callback;var f=new XMLHttpRequest();var d=this.url+(this.url.indexOf("?")==-1?"?":"&")+"_="+new Date().getTime();f.open(this.method,d,true);f.onload=function(){var h;if(e=="json"){h=JSON.parse(f.responseText)}else{h=f.responseText}for(var j=0;j<g.length;j++){g[j](f.status,h)}};f.send()};c.prototype.asString=function(){this.send("string")};c.prototype.asJson=function(){this.send("json")};c.get=function(d){return new c("GET",d)};return c}());b.Http=a})(DynamicLoad||(DynamicLoad={}));var DynamicLoad;(function(b){var a=(function(){function c(e,f,d){this.type="text/css";this.rel="stylesheet";this.callback=[];this.href=e;if(f){this.type=f}if(d){this.rel=d}}c.prototype.addCallback=function(d){this.callback.push(d);return this};c.prototype.load=function(){var e=this;this.css=c.loaded[this.href];var d=function(){for(var f=0;f<e.callback.length;f++){e.callback[f]()}};if(this.css&&this.css.count>0){this.css.count=this.css.count+1;d()}else{c.loaded[this.href]={link:document.createElement("link"),count:1};this.css=c.loaded[this.href];this.css.link.type=this.type;this.css.link.rel=this.rel;this.css.link.href=this.href;this.css.link.onload=d;c.head.appendChild(this.css.link)}return this};c.prototype.destroy=function(){if(!this.css){this.css=c.loaded[this.href]}this.css.count=this.css.count-1;if(this.css.count==0){c.head.removeChild(this.css.link);c.loaded[this.href]=null;this.css=null;return true}return false};c.getInstance=function(f,d,e){return new c(f,d,e)};c.head=document.getElementsByTagName("head")[0];c.loaded={};return c}());b.LoadCss=a})(DynamicLoad||(DynamicLoad={}));var DynamicLoad;(function(a){var b=(function(){function c(d){var e=this;this.jsList=[];this.callback=[];this.http=a.Http.get(d).addCallback(function(g,k){var i=document.createElement("div");i.innerHTML=k;var l=function(){for(var m=0;m<e.callback.length;m++){e.callback[m](g,k)}};var h=i.getElementsByTagName("script");if(h.length!=0){do{var j=h[0];e.jsList.push(a.LoadJs.getInstance(j.src,j.type).load());i.removeChild(j);h=i.getElementsByTagName("script")}while(h.length!=0)}var f=i.getElementsByTagName("body")[0];e.element.innerHTML=f?f.innerHTML:i.innerHTML;if(componentHandler){componentHandler.upgradeAllRegistered()}l()})}c.prototype.addCallback=function(d){this.callback.push(d);return this};c.prototype.put=function(d){this.element=d;this.http.asString();return this};c.prototype.destroy=function(e){if(e){this.element=e}this.element.innerHTML="";for(var d=0;d<this.jsList.length;d++){this.jsList[d].destroy()}this.jsList=[]};c.getInstance=function(d){return new c(d)};return c}());a.LoadHtml=b})(DynamicLoad||(DynamicLoad={}));var DynamicLoad;(function(a){var b=(function(){function c(e,d){this.type="text/javascript";this.callback=[];this.src=e;if(d){this.type=d}}c.prototype.addCallback=function(d){if(d){this.callback.push(d)}return this};c.prototype.load=function(){var f=this;this.js=c.loaded[this.src];var e=function(){for(var g=0;g<f.callback.length;g++){f.callback[g]()}};if(this.js&&this.js.count>0){this.js.count=this.js.count+1;e()}else{var d=this.src+(this.src.indexOf("?")==-1?"?":"&")+"_="+new Date().getTime();c.loaded[this.src]={script:document.createElement("script"),count:1};this.js=c.loaded[this.src];this.js.script.type=this.type;this.js.script.src=d;this.js.script.onload=e;c.head.appendChild(this.js.script)}return this};c.prototype.destroy=function(){if(!this.js){this.js=c.loaded[this.src]}this.js.count=this.js.count-1;if(this.js.count==0){c.head.removeChild(this.js.script);c.loaded[this.src]=null;this.js=null;return true}return false};c.getInstance=function(e,d){return new c(e,d)};c.head=document.getElementsByTagName("head")[0];c.loaded={};return c}());a.LoadJs=b})(DynamicLoad||(DynamicLoad={}));var DynamicLoad;(function(b){var a=(function(){function c(){}c.enchantUrl=function(){var e=window.location.href;e=e.replace(/#+!+\/*|$/,"#!/");var f=e.indexOf("#!/")+3;var g=e.slice(0,f);var d=e.slice(f);d=d.replace(/\/+/g,"/");if(d.length>0&&d.slice(-1)=="/"){d=d.slice(0,-1)}e=g+d;var h=window.location.href==e;if(!h){window.location.replace(e)}return h};c.uri=function(d){var e=window.location.href;var f=e.indexOf("#!");if(d){window.location.replace(e.slice(0,f==-1?e.length:f)+"#!"+d);return d}else{if(f!=-1){var g=e.slice(f+2,e.length);return g?g:"/"}else{return"/"}}};c.path=function(){var e=this.uri();var f=e.indexOf("?");var d=e.indexOf("#");return e.slice(0,(f==-1&&d==-1?e.length:(f<d?f:d))).replace(/\/{2,}/g,"/")};c.query=function(d){var g=this.uri();var i=g.indexOf("?");var f=g.indexOf("#");if(d){var e=new RegExp("[?&]"+d+"(=([^&#]*)|&|#|$)").exec(this.query());if(!e){return null}if(!e[2]){return""}return decodeURIComponent(e[2].replace(/\+/g," "))}else{return g.slice(i,(f<g.length&&i<f?f:g.length))}};c.hash=function(){var e=this.uri();var f=e.indexOf("?");var d=e.indexOf("#");return e.slice(d+1,(f<e.length&&d<f?f:e.length))};return c}());b.Location=a})(DynamicLoad||(DynamicLoad={}));var DynamicLoad;(function(a){var b=(function(){function c(){}c.uriListener=function(d){if(a.Location.enchantUrl()){d()}window.addEventListener("hashchange",function(){if(a.Location.enchantUrl()){d()}})};c.run=function(e){var f=function(g,h,j){var i=function(p){var n={};var s=p[h];if(!s){var q=Object.keys(p);for(var m=0;m<q.length;m++){var r=new RegExp("^"+q[m].replace(/\{\*}$/,"(.+)").replace(/\{([^\/]+)}/g,"([^\\/]+)")+"$");if(r.test(h)){var k=r.exec(q[m]).slice(1);var o=r.exec(h).slice(1);for(var l=0;l<k.length;l++){n[k[l].replace(/^\{(.+)}$/,"$1")]=o[l]}s=p[q[m]];break}}}if(typeof s=="string"){f(s,h,j)}else{j(s,n)}};if(!c.routes[g]){a.Http.get(g).addCallback(function(l,k){c.routes[g]=k;i(k)}).asJson()}else{i(c.routes[g])}};var d=function(l,g,m,n){if(l){var j=l.split(".");var k=g;for(var h=0;h<j.length;h++){if(k[j[h]]){k=k[j[h]]}}if(typeof k=="function"){k(n,m)}}};c.uriListener(function(){var m=a.Location.path();for(var l=0;l<c.curJs.length;l++){if(c.curJs[l].options.reload){d(c.curJs[l].options.destroy,window,c.curJs[l].options.data,c.curParams);c.curJs[l].loadJs.destroy();c.curJs.splice(l,1);l--}}var g=[];var n=[];var h=function(){if(c.curHtml){c.curHtml.destroy();c.curHtml=null}};var k=function(){for(var o=0;o<c.curCss.length;o++){c.curCss[o].destroy()}c.curCss=n};var j=function(p){for(var o=0;o<c.curJs.length;o++){d(c.curJs[o].options.destroy,window,c.curJs[o].options.data,p);c.curJs[o].loadJs.destroy()}c.curJs=g};f(e,m,function(x,t){var r={};for(var y in c.curParams){if(c.curParams.hasOwnProperty(y)){r[y]=c.curParams[y]}}c.curParams=t;if(x){var u=function(A){if(x.html){var i=document.getElementById("body");if(!i){i=document.getElementsByTagName("body")[0]}c.curHtml=a.LoadHtml.getInstance(x.html);if(A){c.curHtml.addCallback(A)}c.curHtml.addCallback(function(){j(r)});c.curHtml.put(i)}else{if(A){A()}j(r);h()}};var w=function(){if(x.css){for(var A=0;A<x.css.length;A++){n.push(a.LoadCss.getInstance(x.css[A]).load())}}k()};var o=function(C){for(var B=0;B<C.length;B++){var A=x.js[C[B]];g.push({loadJs:a.LoadJs.getInstance(C[B]).addCallback(function(){d(A.create,window,A.data,c.curParams)}).load(),options:A})}};w();if(x.js){var v=Object.keys(x.js);var p=false;for(var s=0,q=0;s<v.length;s++){if(x.js[v[s]].preload){var z=x.js[v[s]];p=true;q++;g.push({loadJs:a.LoadJs.getInstance(v[s]).addCallback(function(){d(z.create,window,z.data,c.curParams);q--;if(q==0){u(function(){o(v)})}}).load(),options:z});v.splice(s,1);s--}}if(!p){u(function(){o(v)})}}else{u()}}else{j(r);h()}})})};c.routes={};c.curParams={};c.curCss=[];c.curJs=[];return c}());a.Route=b})(DynamicLoad||(DynamicLoad={}));