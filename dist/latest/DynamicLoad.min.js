var DynamicLoad;
(function(f){var h=function(){function a(c,b){this.cloneNodes=[];if(c instanceof HTMLElement){if(componentHandler){var a=c.querySelectorAll("[data-upgraded]");0<a.length&&componentHandler.downgradeElements(a)}a=document.createElement("div");a.appendChild(c.cloneNode(!0));this.element=c;this.elemHTML=a.innerHTML;c.style.display="none";b&&(b.innerHTML="");this.parent=b||c.parentNode}else this.elemHTML=c,b&&(b.innerHTML=""),this.parent=b}a.prototype.getNodes=function(){return this.cloneNodes};a.prototype.bind=
function(c){for(var b=1;b<this.cloneNodes.length;b++)this.parent.removeChild(this.cloneNodes[b].node);if(0!=this.cloneNodes.length){this.cloneNodes=[this.cloneNodes[0]];for(var b=Object.keys(c),a=0;a<b.length;a++)if(this.cloneNodes[0].cloneData[b[a]]!=c[b[a]]){b=this.bindedNodes(c);for(a=0;a<b.length;a++)this.parent.insertBefore(b[a],this.cloneNodes[0].nodes[this.cloneNodes[0].nodes.length-1].nextSibling);for(a=0;a<this.cloneNodes[0].nodes.length;a++)this.parent.removeChild(this.cloneNodes[0].nodes[a]);
this.cloneNodes[0].nodes=b;this.cloneNodes[0].cloneData=JSON.parse(JSON.stringify(c));break}}else{for(var b=this.bindedNodes(c),e=this.element?this.element.nextSibling:this.parent.firstChild,a=0;a<b.length;a++)this.parent.insertBefore(b[a],e);this.cloneNodes.push({data:c,cloneData:JSON.parse(JSON.stringify(c)),nodes:b})}return this};a.prototype.refresh=function(){for(var c=0;c<this.cloneNodes.length;c++)for(var a=Object.keys(this.cloneNodes[c].data),d=0;d<a.length;d++)if(this.cloneNodes[c].cloneData[a[d]]!=
this.cloneNodes[c].data[a[d]]){a=this.bindedNodes(this.cloneNodes[c].data);for(d=0;d<a.length;d++)this.parent.insertBefore(a[d],this.cloneNodes[c].nodes[this.cloneNodes[c].nodes.length-1].nextSibling);for(d=0;d<this.cloneNodes[c].nodes.length;d++)this.parent.removeChild(this.cloneNodes[c].nodes[d]);this.cloneNodes[c].nodes=a;this.cloneNodes[c].cloneData=JSON.parse(JSON.stringify(this.cloneNodes[c].data));break}return this};a.prototype.repeat=function(c,a){for(var d=0;d<this.cloneNodes.length;d++)if(-1==
c.indexOf(this.cloneNodes[d].data)){for(var e=0;e<this.cloneNodes[d].nodes.length;e++)this.parent.removeChild(this.cloneNodes[d].nodes[e]);this.cloneNodes.splice(d,1);--d}a&&this.refresh();for(var g=this.cloneNodes.length-1,d=c.length-1;0<=d;d--)if(-1!=g&&this.cloneNodes[g].data===c[d])g--;else{for(var f=this.bindedNodes(c[d]),k=-1==g?this.element?this.element.nextSibling:this.parent.firstChild:this.cloneNodes[g].nodes[this.cloneNodes[g].nodes.length-1].nextSibling,e=0;e<f.length;e++)this.parent.insertBefore(f[e],
k);this.cloneNodes.splice(g+1,0,{data:c[d],cloneData:JSON.parse(JSON.stringify(c[d])),nodes:f})}return this};a.prototype.bindedNodes=function(c){var a=document.createElement("div");a.innerHTML=this.elemHTML;if(c){for(var d=Object.keys(c),e=0;e<d.length;e++)a.innerHTML=a.innerHTML.replace(new RegExp("{{"+d[e]+"}}","g"),c[d[e]]);a.innerHTML=a.innerHTML.replace(/{{[^}]*}}/g,"")}c=[];c.length=a.childNodes.length;for(e=0;e<a.childNodes.length;e++)c[e]=a.childNodes[e];return c};return a}();f.Element=h})(DynamicLoad||
(DynamicLoad={}));
(function(f){var h=function(){function a(c,a,d){this.callback=[];this.method=c;this.url=a;this.setData(d)}a.prototype.addCallback=function(c){this.callback.push(c);return this};a.prototype.send=function(c){var a=this,d=this.callback,e=new XMLHttpRequest,g=function(e,g){e&&(a.status=e);g&&(a.responseText=g);var f;f="json"==c?JSON.parse(a.responseText):a.responseText;for(var r=0;r<d.length;r++)d[r](e,f)};if(this.status)g();else{var f=this.url+(-1==this.url.indexOf("?")?"?":"&")+"_="+(new Date).getTime();
e.open(this.method,f,!0);this.contentType&&e.setRequestHeader("Content-Type",this.contentType);this.auth&&e.setRequestHeader("Authorization",this.auth);e.onload=function(){g(e.status,e.responseText)};e.onerror=function(){g(e.status,e.responseText)};this.data?e.send(this.data):e.send()}};a.prototype.setAuth=function(a){this.auth=a;return this};a.prototype.setData=function(a){this.data=a;this.data instanceof FormData?this.contentType=void 0:"string"!=typeof this.data&&(this.data=JSON.stringify(this.data),
this.contentType="application/json");return this};a.prototype.asString=function(a){a&&this.addCallback(a);this.send("string")};a.prototype.asJson=function(a){a&&this.addCallback(a);this.send("json")};a.get=function(c){return new a("GET",c)};a.put=function(c,b){return(new a("PUT",c)).setData(b)};a.post=function(c,b){return(new a("POST",c)).setData(b)};a["delete"]=function(c,b){return(new a("DELETE",c)).setData(b)};return a}();f.Http=h})(DynamicLoad||(DynamicLoad={}));
(function(f){var h=function(){function a(a){this.handlers=[];this.element=a}a.prototype.inViewport=function(c,b){var d=a.onVisibilityChange(c,b);this.handlers.push({events:["DOMContentLoaded","load","scroll","resize"],handler:d});addEventListener?(addEventListener("DOMContentLoaded",d,!1),addEventListener("load",d,!1),addEventListener("scroll",d,!1),addEventListener("resize",d,!1)):attachEvent&&(attachEvent("onDOMContentLoaded",d),attachEvent("onload",d),attachEvent("onscroll",d),attachEvent("onresize",
d));return this};a.prototype.destroy=function(){for(var a=0;a<this.handlers.length;a++)if(removeEventListener)for(var b=0;b<this.handlers.events.length;b++)removeEventListener(this.handlers.events[b],this.handlers[a],!1);else if(detachEvent)for(b=0;b<this.handlers.events.length;b++)detachEvent("on"+this.handlers.events[b],this.handlers[a],!1);return this};a.onVisibilityChange=function(c,b){var d;return function(){var e=a.isElementInViewport(c);e!=d&&(d=e,"function"==typeof b&&b())}};a.isElementInViewport=
function(a){a=a.getBoundingClientRect();return 0<=a.top&&0<=a.left&&a.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&a.right<=(window.innerWidth||document.documentElement.clientWidth)};return a}();f.Listener=h})(DynamicLoad||(DynamicLoad={}));
(function(f){var h=function(){function a(a,b,d){this.type="text/css";this.rel="stylesheet";this.callback=[];this.href=a;b&&(this.type=b);d&&(this.rel=d)}a.prototype.addCallback=function(a){this.callback.push(a);return this};a.prototype.load=function(){var c=this;this.css=a.loaded[this.href];var b=function(){for(var a=0;a<c.callback.length;a++)c.callback[a]()};this.css&&0<this.css.count?(this.css.count+=1,b()):(a.loaded[this.href]={link:document.createElement("link"),count:1},this.css=a.loaded[this.href],
this.css.link.type=this.type,this.css.link.rel=this.rel,this.css.link.href=this.href,this.css.link.onload=b,a.head.appendChild(this.css.link));return this};a.prototype.destroy=function(){this.css||(this.css=a.loaded[this.href]);--this.css.count;return 0==this.css.count?(a.head.removeChild(this.css.link),this.css=a.loaded[this.href]=null,!0):!1};a.getInstance=function(c,b,d){return new a(c,b,d)};a.head=document.getElementsByTagName("head")[0];a.loaded={};return a}();f.LoadCss=h})(DynamicLoad||(DynamicLoad=
{}));
(function(f){var h=function(){function a(a){var b=this;this.isAppend=!1;this.callback=[];this.src=a;this.http=f.Http.get(a).addCallback(function(a,c){var g=document.createElement("div");g.innerHTML=c;if(b.dataBindRule){for(var f=Object.keys(b.dataBindRule),h=0;h<f.length;h++)g.innerHTML=g.innerHTML.replace(new RegExp("{{"+f[h]+"}}","g"),b.dataBindRule[f[h]]);g.innerHTML=g.innerHTML.replace(/{{[^}]*}}/g,"")}b.isAppend||(b.element.innerHTML="");(function(a){for(var c=g.childNodes,b=0;b<c.length;b++)a.appendChild(c[b])})(b.element);componentHandler&&
componentHandler.upgradeAllRegistered();(function(){for(var g=0;g<b.callback.length;g++)b.callback[g](a,c)})()})}a.prototype.addCallback=function(a){this.callback.push(a);return this};a.prototype.put=function(a,b){this.element=a;this.isAppend=!1;this.dataBindRule=b;this.http.asString();return this};a.prototype.append=function(a,b){this.element=a;this.isAppend=!0;this.dataBindRule=b;this.http.asString();return this};a.prototype.destroy=function(a){a&&(this.element=a);this.element&&(this.element.innerHTML=
"")};a.getInstance=function(c){return new a(c)};return a}();f.LoadHtml=h})(DynamicLoad||(DynamicLoad={}));
(function(f){var h=function(){function a(a,b){this.type="text/javascript";this.callback=[];this.src=a;b&&(this.type=b)}a.prototype.addCallback=function(a){a&&this.callback.push(a);return this};a.prototype.load=function(){var c=this;this.js=a.loaded[this.src];var b=function(){for(var a=0;a<c.callback.length;a++)c.callback[a]()};if(this.js&&0<this.js.count)this.js.count+=1,b();else{var d=this.src+(-1==this.src.indexOf("?")?"?":"&")+"_="+(new Date).getTime();a.loaded[this.src]={script:document.createElement("script"),
count:1};this.js=a.loaded[this.src];this.js.script.type=this.type;this.js.script.src=d;this.js.script.onload=b;a.head.appendChild(this.js.script)}return this};a.prototype.destroy=function(){this.js||(this.js=a.loaded[this.src]);--this.js.count;return 0==this.js.count?(a.head.removeChild(this.js.script),this.js=a.loaded[this.src]=null,!0):!1};a.getInstance=function(c,b){return new a(c,b)};a.head=document.getElementsByTagName("head")[0];a.loaded={};return a}();f.LoadJs=h})(DynamicLoad||(DynamicLoad=
{}));
(function(f){var h=function(){function a(){}a.enchantUrl=function(){var a=window.location.href,a=a.replace(/#+!+\/*|$/,"#!/"),b=a.indexOf("#!/")+3,d=a.slice(0,b),a=a.slice(b),a=a.replace(/\/{2,}/g,"/");0<a.length&&"/"==a.slice(-1)&&(a=a.slice(0,-1));a=d+a;(d=window.location.href==a)||window.location.replace(a);return d};a.uri=function(a){var b=window.location.href,d=b.indexOf("#!");return a?(window.location.replace(b.slice(0,-1==d?b.length:d)+"#!"+a),a):-1!=d?(a=b.slice(d+2,b.length))?a:"/":"/"};
a.path=function(){var a=this.uri(),b=a.indexOf("?"),d=a.indexOf("#"),e=a.length;-1!=b&&-1!=d?e=b<d?b:d:-1!=b&&-1==d?e=b:-1==b&&-1!=d&&(e=d);return a.slice(0,e).replace(/\/{2,}/g,"/")};a.query=function(a){var b=this.uri(),d=b.indexOf("?"),e=b.indexOf("#");return a?(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(this.query()))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null:b.slice(d,e<b.length&&d<e?e:b.length)};a.hash=function(){var a=this.uri(),b=a.indexOf("?"),d=a.indexOf("#");return a.slice(d+
1,b<a.length&&d<b?b:a.length)};return a}();f.Location=h})(DynamicLoad||(DynamicLoad={}));
(function(f){var h=function(){function a(){}a.uriListener=function(a){f.Location.enchantUrl()&&a();window.addEventListener("hashchange",function(){f.Location.enchantUrl()&&a()})};a.run=function(c){var b=function(d,c,h){var k=function(a){var d={},e=a[c];if(!e)for(var f=Object.keys(a),n=0;n<f.length;n++){var p=new RegExp("^"+f[n].replace(/\{\*}$/,"(.+)").replace(/\{([^\/]+)}/g,"([^\\/]+)")+"$");if(p.test(c)){for(var e=p.exec(f[n]).slice(1),p=p.exec(c).slice(1),k=0;k<e.length;k++)d[e[k].replace(/^\{(.+)}$/,
"$1")]=p[k];e=a[f[n]];break}}"string"==typeof e?b(e,c,h):h(e,d)};a.routes[d]?k(a.routes[d]):f.Http.get(d).addCallback(function(b,c){a.routes[d]=c;k(c)}).asJson()},d=function(a,b,d,c){if(a){a=a.split(".");for(var f=0;f<a.length;f++)if(b[a[f]])b=b[a[f]];else return;"function"==typeof b&&b(c,d)}};a.uriListener(function(){for(var e=f.Location.path(),g=0;g<a.curJs.length;g++)a.curJs[g].options.reload&&(d(a.curJs[g].options.destroy,window,a.curJs[g].options.data,a.curParams),a.curJs[g].loadJs.destroy(),
a.curJs.splice(g,1),g--);var h=[],k=[],w=function(){a.curHtml&&(a.curHtml.destroy(),a.curHtml=null)},q=function(b){for(var c=0;c<a.curJs.length;c++)d(a.curJs[c].options.destroy,window,a.curJs[c].options.data,b),a.curJs[c].loadJs.destroy();a.curJs=h};b(c,e,function(b,c){var e={},g;for(g in a.curParams)a.curParams.hasOwnProperty(g)&&(e[g]=a.curParams[g]);a.curParams=c;if(b){var t=function(c){if(b.html){var d=document.getElementById("body");d||(d=document.getElementsByTagName("body")[0]);a.curHtml=f.LoadHtml.getInstance(b.html);
c&&a.curHtml.addCallback(c);a.curHtml.addCallback(function(){q(e)});a.curHtml.put(d)}else c&&c(),q(e),w()},x=function(c){for(var e=0;e<c.length;e++){var g=b.js[c[e]];h.push({loadJs:f.LoadJs.getInstance(c[e]).addCallback(function(){d(g.create,window,g.data,a.curParams)}).load(),options:g})}};(function(){if(b.css)for(var c=0;c<b.css.length;c++)k.push(f.LoadCss.getInstance(b.css[c]).load());for(c=0;c<a.curCss.length;c++)a.curCss[c].destroy();a.curCss=k})();if(b.js){var l=Object.keys(b.js);g=!1;for(var m=
0,u=0;m<l.length;m++)if(b.js[l[m]].preload){var v=b.js[l[m]];g=!0;u++;h.push({loadJs:f.LoadJs.getInstance(l[m]).addCallback(function(){d(v.create,window,v.data,a.curParams);u--;0==u&&t(function(){x(l)})}).load(),options:v});l.splice(m,1);m--}g||t(function(){x(l)})}else t()}else q(e),w()})})};a.routes={};a.curParams={};a.curCss=[];a.curJs=[];return a}();f.Route=h})(DynamicLoad||(DynamicLoad={}));
