var DynamicLoad;
(function(d){var h=function(){function a(a,b,c){this.callback=[];this.method=a;this.url=b;this.setData(c)}a.prototype.addCallback=function(a){this.callback.push(a);return this};a.prototype.send=function(a){var b=this,c=this.callback,f=new XMLHttpRequest,g=function(f,g){f&&(b.status=f);g&&(b.responseText=g);var d;d="json"==a?JSON.parse(b.responseText):b.responseText;for(var q=0;q<c.length;q++)c[q](f,d)};if(this.status)g();else{var d=this.url+(-1==this.url.indexOf("?")?"?":"&")+"_="+(new Date).getTime();
f.open(this.method,d,!0);f.setRequestHeader("Content-Type","application/json");f.onload=function(){g(f.status,f.responseText)};this.data?f.send(this.data):f.send()}};a.prototype.setData=function(a){this.data=a;"string"!=typeof this.data&&(this.data=JSON.stringify(this.data));return this};a.prototype.asString=function(){this.send("string")};a.prototype.asJson=function(){this.send("json")};a.get=function(e){return new a("GET",e)};a.put=function(e,b){return(new a("PUT",e)).setData(b)};a.post=function(e,
b){return(new a("POST",e)).setData(b)};a["delete"]=function(e,b){return(new a("DELETE",e)).setData(b)};return a}();d.Http=h})(DynamicLoad||(DynamicLoad={}));
(function(d){var h=function(){function a(a,b,c){this.type="text/css";this.rel="stylesheet";this.callback=[];this.href=a;b&&(this.type=b);c&&(this.rel=c)}a.prototype.addCallback=function(a){this.callback.push(a);return this};a.prototype.load=function(){var e=this;this.css=a.loaded[this.href];var b=function(){for(var a=0;a<e.callback.length;a++)e.callback[a]()};this.css&&0<this.css.count?(this.css.count+=1,b()):(a.loaded[this.href]={link:document.createElement("link"),count:1},this.css=a.loaded[this.href],
this.css.link.type=this.type,this.css.link.rel=this.rel,this.css.link.href=this.href,this.css.link.onload=b,a.head.appendChild(this.css.link));return this};a.prototype.destroy=function(){this.css||(this.css=a.loaded[this.href]);--this.css.count;return 0==this.css.count?(a.head.removeChild(this.css.link),this.css=a.loaded[this.href]=null,!0):!1};a.getInstance=function(e,b,c){return new a(e,b,c)};a.head=document.getElementsByTagName("head")[0];a.loaded={};return a}();d.LoadCss=h})(DynamicLoad||(DynamicLoad=
{}));
(function(d){var h=function(){function a(a){var b=this;this.isAppend=!1;this.callback=[];this.src=a;this.http=d.Http.get(a).addCallback(function(a,e){var g=document.createElement("template");g.innerHTML=e;if(b.dataBindRule)for(var d=Object.keys(b.dataBindRule),k;k<d.length;k++)g.innerHTML=g.innerHTML.replace(new RegExp("/{{"+d[k]+"}}/g"),b.dataBindRule[d[k]]);b.isAppend||(b.element.innerHTML="");(function(a){for(var e=g.content.childNodes,b=0;b<e.length;b++)a.appendChild(e[b])})(b.element);componentHandler&&componentHandler.upgradeAllRegistered();
(function(){for(var g=0;g<b.callback.length;g++)b.callback[g](a,e)})()})}a.prototype.addCallback=function(a){this.callback.push(a);return this};a.prototype.put=function(a,b){this.element=a;this.isAppend=!1;this.dataBindRule=b;this.http.asString();return this};a.prototype.append=function(a,b){this.element=a;this.isAppend=!0;this.dataBindRule=b;this.http.asString();return this};a.prototype.destroy=function(a){a&&(this.element=a);this.element&&(this.element.innerHTML="")};a.getInstance=function(e){return new a(e)};
return a}();d.LoadHtml=h})(DynamicLoad||(DynamicLoad={}));
(function(d){var h=function(){function a(a,b){this.type="text/javascript";this.callback=[];this.src=a;b&&(this.type=b)}a.prototype.addCallback=function(a){a&&this.callback.push(a);return this};a.prototype.load=function(){var e=this;this.js=a.loaded[this.src];var b=function(){for(var a=0;a<e.callback.length;a++)e.callback[a]()};if(this.js&&0<this.js.count)this.js.count+=1,b();else{var c=this.src+(-1==this.src.indexOf("?")?"?":"&")+"_="+(new Date).getTime();a.loaded[this.src]={script:document.createElement("script"),
count:1};this.js=a.loaded[this.src];this.js.script.type=this.type;this.js.script.src=c;this.js.script.onload=b;a.head.appendChild(this.js.script)}return this};a.prototype.destroy=function(){this.js||(this.js=a.loaded[this.src]);--this.js.count;return 0==this.js.count?(a.head.removeChild(this.js.script),this.js=a.loaded[this.src]=null,!0):!1};a.getInstance=function(e,b){return new a(e,b)};a.head=document.getElementsByTagName("head")[0];a.loaded={};return a}();d.LoadJs=h})(DynamicLoad||(DynamicLoad=
{}));
(function(d){var h=function(){function a(){}a.enchantUrl=function(){var a=window.location.href,a=a.replace(/#+!+\/*|$/,"#!/"),b=a.indexOf("#!/")+3,c=a.slice(0,b),a=a.slice(b),a=a.replace(/\/{2,}/g,"/");0<a.length&&"/"==a.slice(-1)&&(a=a.slice(0,-1));a=c+a;(c=window.location.href==a)||window.location.replace(a);return c};a.uri=function(a){var b=window.location.href,c=b.indexOf("#!");return a?(window.location.replace(b.slice(0,-1==c?b.length:c)+"#!"+a),a):-1!=c?(a=b.slice(c+2,b.length))?a:"/":"/"};
a.path=function(){var a=this.uri(),b=a.indexOf("?"),c=a.indexOf("#"),f=a.length;-1!=b&&-1!=c?f=b<c?b:c:-1!=b&&-1==c?f=b:-1==b&&-1!=c&&(f=c);return a.slice(0,f).replace(/\/{2,}/g,"/")};a.query=function(a){var b=this.uri(),c=b.indexOf("?"),f=b.indexOf("#");return a?(a=(new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)")).exec(this.query()))?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null:b.slice(c,f<b.length&&c<f?f:b.length)};a.hash=function(){var a=this.uri(),b=a.indexOf("?"),c=a.indexOf("#");return a.slice(c+
1,b<a.length&&c<b?b:a.length)};return a}();d.Location=h})(DynamicLoad||(DynamicLoad={}));
(function(d){var h=function(){function a(){}a.uriListener=function(a){d.Location.enchantUrl()&&a();window.addEventListener("hashchange",function(){d.Location.enchantUrl()&&a()})};a.run=function(e){var b=function(c,g,e){var k=function(a){var c={},d=a[g];if(!d)for(var f=Object.keys(a),k=0;k<f.length;k++){var n=new RegExp("^"+f[k].replace(/\{\*}$/,"(.+)").replace(/\{([^\/]+)}/g,"([^\\/]+)")+"$");if(n.test(g)){for(var d=n.exec(f[k]).slice(1),n=n.exec(g).slice(1),h=0;h<d.length;h++)c[d[h].replace(/^\{(.+)}$/,
"$1")]=n[h];d=a[f[k]];break}}"string"==typeof d?b(d,g,e):e(d,c)};a.routes[c]?k(a.routes[c]):d.Http.get(c).addCallback(function(b,d){a.routes[c]=d;k(d)}).asJson()},c=function(a,b,c,d){if(a){a=a.split(".");for(var e=0;e<a.length;e++)if(b[a[e]])b=b[a[e]];else return;"function"==typeof b&&b(d,c)}};a.uriListener(function(){for(var f=d.Location.path(),g=0;g<a.curJs.length;g++)a.curJs[g].options.reload&&(c(a.curJs[g].options.destroy,window,a.curJs[g].options.data,a.curParams),a.curJs[g].loadJs.destroy(),
a.curJs.splice(g,1),g--);var h=[],k=[],v=function(){a.curHtml&&(a.curHtml.destroy(),a.curHtml=null)},p=function(b){for(var d=0;d<a.curJs.length;d++)c(a.curJs[d].options.destroy,window,a.curJs[d].options.data,b),a.curJs[d].loadJs.destroy();a.curJs=h};b(e,f,function(b,e){var g={},f;for(f in a.curParams)a.curParams.hasOwnProperty(f)&&(g[f]=a.curParams[f]);a.curParams=e;if(b){var r=function(c){if(b.html){var e=document.getElementById("body");e||(e=document.getElementsByTagName("body")[0]);a.curHtml=d.LoadHtml.getInstance(b.html);
c&&a.curHtml.addCallback(c);a.curHtml.addCallback(function(){p(g)});a.curHtml.put(e)}else c&&c(),p(g),v()},w=function(e){for(var f=0;f<e.length;f++){var g=b.js[e[f]];h.push({loadJs:d.LoadJs.getInstance(e[f]).addCallback(function(){c(g.create,window,g.data,a.curParams)}).load(),options:g})}};(function(){if(b.css)for(var c=0;c<b.css.length;c++)k.push(d.LoadCss.getInstance(b.css[c]).load());for(c=0;c<a.curCss.length;c++)a.curCss[c].destroy();a.curCss=k})();if(b.js){var l=Object.keys(b.js);f=!1;for(var m=
0,t=0;m<l.length;m++)if(b.js[l[m]].preload){var u=b.js[l[m]];f=!0;t++;h.push({loadJs:d.LoadJs.getInstance(l[m]).addCallback(function(){c(u.create,window,u.data,a.curParams);t--;0==t&&r(function(){w(l)})}).load(),options:u});l.splice(m,1);m--}f||r(function(){w(l)})}else r()}else p(g),v()})})};a.routes={};a.curParams={};a.curCss=[];a.curJs=[];return a}();d.Route=h})(DynamicLoad||(DynamicLoad={}));
